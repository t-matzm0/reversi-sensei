# Reversi Sensei 開発ガイドライン

このドキュメントは、Reversi Senseiプロジェクトの開発ルールと履歴を記録したものです。
Claude Codeを使用する際は、必ずこのドキュメントを参照して、プロジェクトの一貫性を保ってください。

## プロジェクト概要

Reversi Sensei（リバーシ先生）は、リバーシ（オセロ）の戦略を学ぶためのWebアプリケーションです。
Next.js、React、TypeScriptを使用して構築され、Firebase Hostingでホスティングされています。

## 開発履歴

### 2025年6月13日 - プロジェクト開始

- 初期プロジェクトセットアップ（Next.js + TypeScript）
- コアゲームロジックとAIの実装
- React UIコンポーネントの作成
- クロスプラットフォームデプロイメント設定
- 包括的なプロジェクトドキュメントの追加
- GitHub Actions CI/CDのセットアップ
- Firebase環境（ステージング/本番）のセットアップ

### 2025年6月14日

- リバーシ戦略チュートリアルの実装

### 2025年6月19日

- モジュラー構造によるゲームアーキテクチャの強化
- Jestテスティングフレームワークと初期テストスイートの追加

### 2025年6月20日

- CI/CDパイプラインの修正
- Firebaseプロジェクトの統合（マルチサイトホスティング）
- ステージングURLの更新
- 最後の手の表示バグ修正（#1）
- 手の評価表示機能の追加（#2, #8）
- 評価表示の即時更新問題の修正
- 序盤の手の評価正規化の改善

### 2025年6月26日

- コードフォーマットとテスト失敗の解決

### 2025年7月2日

【作業内容】

- CLAUDE.md（開発ガイドライン）の作成
- プロジェクトの開発履歴をコミットログから抽出
- コードベースから開発ルールとパターンを分析・文書化
- Git操作のベストプラクティスを追加（コミット粒度、静的テスト実行）
- 今後の開発予定セクションを追加
- GitHub Projects/Issuesとの使い分けを明確化
- GitHub Issuesに主要な機能要望を登録
  - #9: オンライン対戦機能の実装
  - #10: AIの強化
  - #11: 統計・分析機能の追加
  - #12: UI/UXの改善
  - #13: チュートリアルの拡充
- Markdownリンターの警告を修正

- Git Flow開発フローのルールを追加
- Issue #2（評価値表示機能）のクローズ確認と対応
- Issue #5（白背景に白文字のバグ）の調査と修正

  - `piece-white`色を#f0f0f0から#e0e0e0に変更
  - PR #15でバグ修正完了

- Issue #4（待った機能）の実装完了

  - ゲーム設定に`allowUndo`フラグを追加
  - useGameStateフックに履歴管理機能を実装
    - `addMoveToHistory`: 手の履歴を記録
    - `makeGameMove`: 手の実行と履歴追加を統合
    - `undoLastMove`: 最後の手を取り消す機能
  - GameInfoコンポーネントに待った設定トグルと実行ボタンを追加
  - Gameコンポーネントで新しいフック関数を統合
  - 全てのテストとビルドが正常に通過することを確認

- Issue #16（評価値が正確に計算されていない）の対応開始

  - 問題分析：AIが先読みを実装していない（depthの設定が使われていない）
  - ミニマックス法とアルファベータ剪定を実装
  - 評価関数の改善：
    - ゲーム終了時の正確な評価
    - モビリティ（有効手数）の考慮
    - ゲーム進行度に応じた評価の重み付け調整
  - 全てのテストが通過することを確認

- Issue管理のミス対応
  - Issue #4と#5を誤ってクローズしてしまったため再オープン
  - レビュー待ちのコメントを追加
  - CLAUDE.mdにIssue管理ルールを追加：
    - 作業開始前にIn Progressに設定する
    - 実装完了後も勝手にクローズしない
    - レビュー承認後のマージ時にクローズ

【次回への申し送り】

- PR #17のレビュー待ち（Issue #16: AI評価関数の改善）
- Issue #4と#5のレビュー待ち（developブランチの9745241で実装済み）
- AIのさらなる改善（安定石、辺の形、開放度などの実装）
- 待った機能のテストケース追加（低優先度）
- 次の新機能開発の検討（Issue #6のアニメーション機能など）

### 開発作業記録の更新ルール

このセクションは**日々の作業メモ**として使用する：

1. **作業開始時**

   - 本日の作業予定を箇条書きで記載
   - 前回の作業から引き継ぐタスクを明記

2. **作業中**

   - 実装した内容を随時追記
   - 発生した問題や解決方法をメモ
   - 次回に持ち越すタスクを記録

3. **記録フォーマット**

   ```text
   ### YYYY年MM月DD日

   【作業予定】
   - タスク1
   - タスク2

   【実装内容】
   - 完了した作業の詳細
   - 変更したファイルと理由

   【次回への申し送り】
   - 未完了のタスク
   - 調査が必要な項目
   ```

### GitHub Projects/Issuesとの使い分け

- **GitHub Issues**: 機能単位の大きなタスク管理（例：「オンライン対戦機能の実装」）
- **GitHub Projects**: プロジェクト全体の進捗管理とロードマップ
- **CLAUDE.md開発記録**: 日々の細かい作業メモと申し送り事項

## 開発ルール

### 1. 命名規則

#### コンポーネント

- **PascalCase**を使用（例：`GameBoard`, `GameInfo`）
- ファイル名はコンポーネント名と完全に一致させる
- 目的が明確にわかる説明的な名前を使用

#### 関数

- **camelCase**を使用
- アクション関数には動詞プレフィックスを付ける（例：`makeMove`, `createInitialBoard`）
- ブール値を返す関数は`is`で始める（例：`isValidMove`, `isGameOver`）
- イベントハンドラーは`handle`で始める（例：`handleCellClick`, `handleAIMove`）

#### 変数

- **camelCase**を使用
- 説明的な名前を使用（例：`currentPlayer`, `possibleMoves`）
- 定数は**UPPER_SNAKE_CASE**（例：`BOARD_SIZE`, `INITIAL_SCORES`）

#### ファイル

- TypeScript/JavaScriptファイルは**camelCase**
- コンポーネントファイルはコンポーネント名と一致
- ユーティリティ/ライブラリファイルは説明的な名前（例：`gameLogic.ts`, `board.ts`）

### 2. インポート順序

以下の順序でインポートを整理：

1. React/Next.js関連
2. サードパーティライブラリ
3. 内部コンポーネント（`@/components`）
4. 型定義（`@/types`）
5. カスタムフック（`@/hooks`）
6. ライブラリ（`@/lib`）
7. ユーティリティ（`@/utils`）
8. 定数（`@/constants`）

### 3. コミットメッセージ

**Conventional Commits**形式を使用：

- `feat:` 新機能
- `fix:` バグ修正
- `refactor:` リファクタリング
- `test:` テスト関連
- `docs:` ドキュメント更新
- `ci:` CI/CD関連
- `debug:` デバッグ用（マージ前に削除）

### 4. コード構造

#### コンポーネント構造

1. インターフェース定義
2. コンポーネント関数（propsの分割代入）
3. カスタムフックの使用
4. `useCallback`でイベントハンドラー定義
5. パフォーマンスクリティカルなコンポーネントは`React.memo`でメモ化
6. セマンティックHTMLとTailwind CSSクラスを使用したJSX

#### フック構造

1. インポート文
2. 状態とメソッドを含むオブジェクトを返すフック関数
3. 必要に応じて`useState`、`useCallback`、`useEffect`を使用
4. 関心の分離を明確に

### 5. テスト

- テストファイルは`src/__tests__/`ディレクトリに配置
- ファイル名：`[ComponentName].test.tsx`または`[moduleName].test.ts`
- React Testing Libraryを使用
- Arrange-Act-Assertパターンを使用
- 説明的なテスト名を使用

### 6. スタイリング

- Tailwind CSSを使用
- 一貫したスペーシングとカラースキーム
- レスポンシブデザイン（`md:`ブレークポイント）
- 日本語UIテキストを使用

### 7. TypeScript

- 厳格モードを有効化
- `any`型の使用禁止
- nullチェックの徹底
- コンポーネントpropsにはインターフェースを使用

### 8. エラーハンドリング

- ErrorBoundaryでコンポーネントをラップ
- ユーザーフレンドリーな日本語エラーメッセージ
- デバッグ用にコンソールにエラーログを出力
- 操作前にnull/undefinedチェック

### 9. パフォーマンス

- 高価な操作とコンポーネントはメモ化
- `'use client'`ディレクティブの適切な使用
- 必要に応じて`useCallback`と`useMemo`を使用

### 10. ファイル作成ルール

- **既存ファイルの編集を優先**する
- 新規ファイルは絶対に必要な場合のみ作成
- ドキュメントファイル（\*.md）は明示的に要求された場合のみ作成
- READMEファイルのプロアクティブな作成は禁止

### 11. Git操作

- コミットは明示的に要求された場合のみ実行
- プロアクティブなコミットは禁止
- git configの変更は禁止

## プロジェクト構造

```text
reversi_sensei/
├── src/
│   ├── app/              # Next.js App Routerページ
│   ├── components/       # Reactコンポーネント
│   ├── lib/              # ビジネスロジック
│   ├── hooks/            # カスタムフック
│   ├── types/            # TypeScript型定義
│   ├── constants/        # 定数
│   ├── utils/            # ユーティリティ関数
│   └── __tests__/        # テストファイル
├── public/               # 静的アセット
└── out/                  # ビルド出力
```

## 開発コマンド

- `npm run dev` - 開発サーバー起動
- `npm test` - テスト実行
- `npm run lint` - ESLint実行
- `npm run format` - Prettier実行
- `npm run build` - プロダクションビルド

## 重要な注意事項

1. **日本語対応**: すべてのUIテキストは日本語で記述
2. **アクセシビリティ**: ARIAラベルとセマンティックHTMLを使用
3. **レスポンシブ対応**: モバイルとデスクトップの両方に対応
4. **型安全性**: TypeScriptの厳格モードを維持

## 今後の開発時の確認事項

新機能を追加する際は、以下を確認してください：

1. 既存のコードパターンに従っているか
2. 適切なテストが追加されているか
3. TypeScriptの型が正しく定義されているか
4. コミットメッセージがConventional Commits形式か
5. 日本語UIテキストが適切か
6. レスポンシブデザインが維持されているか
7. パフォーマンスへの影響を考慮したか

## 今後の開発予定

### 未実装機能・改善項目

以下の機能は今後実装予定です（優先度順）：

1. **オンライン対戦機能**

   - WebSocketを使用したリアルタイム対戦
   - ルーム作成・参加機能
   - 観戦モード

2. **AIの強化**

   - より高度な評価関数の実装
   - 機械学習モデルの導入検討
   - 思考過程の可視化

3. **統計・分析機能**

   - 対戦履歴の保存
   - 勝率・統計情報の表示
   - 棋譜の保存・読み込み

4. **UI/UXの改善**

   - アニメーションの追加
   - サウンドエフェクト
   - テーマカスタマイズ機能

5. **チュートリアルの拡充**
   - インタラクティブなチュートリアル
   - 戦略解説の追加
   - 練習問題モード

### GitHub Projects/Issues連携

- 新機能の実装時は必ずGitHub Issueを作成
- 進捗はGitHub Projectsで管理
- PRには関連するIssue番号を記載

## Git操作のベストプラクティス

### Git Flow開発フロー

このプロジェクトでは**Git Flow**に従って開発を行う：

1. **ブランチ戦略**

   - `main`: 本番環境用（リリース済みのコード）
   - `develop`: 開発環境用（次回リリース予定のコード）
   - `feature/機能名`: 新機能開発用ブランチ
   - `bugfix/バグ名`: バグ修正用ブランチ
   - `hotfix/修正名`: 緊急修正用ブランチ

2. **開発フロー**

   - 新機能開発: `develop`から`feature/`ブランチを作成
   - バグ修正: `develop`から`bugfix/`ブランチを作成
   - 作業完了後: PRを作成してdevelopにマージ
   - developマージ後: ステージング環境で動作確認
   - リリース時: developからmainにマージ

3. **ブランチ命名規則**
   - `feature/issue-番号-簡潔な説明` (例: `feature/9-online-multiplayer`)
   - `bugfix/issue-番号-簡潔な説明` (例: `bugfix/5-white-text-fix`)
   - `hotfix/緊急度-簡潔な説明` (例: `hotfix/critical-security-fix`)

### コミットの粒度

- **適切な粒度でコミットを区切る**
  - 1つのコミットには1つの論理的な変更のみを含める
  - 機能追加、バグ修正、リファクタリングを混在させない
  - レビューしやすい単位でコミットする

### 静的テストの実行

- **コミット前に必ず静的テストを実行**
  - `npm run lint` - ESLintでコード品質チェック
  - `npm run typecheck` - TypeScriptの型チェック（該当する場合）
  - `npm test` - ユニットテストの実行
  - すべてのテストがパスすることを確認してからコミット

### コミット前チェックリスト

1. 不要なconsole.logやデバッグコードを削除したか
2. コードフォーマットを適用したか（`npm run format`）
3. 静的テストがすべてパスしたか
4. コミットメッセージはConventional Commits形式か
5. 関連する変更がすべて含まれているか

### Issue管理のルール

1. **Issueのステータス管理**

   - 作業開始前: **必ずIssueをIn Progressに設定**
   - PR作成時: **IssueをIn Reviewに変更**
   - 実装完了後も**勝手にIssueをクローズしない**
   - レビュー承認後、マージ時にIssueをクローズ

2. **Issue対応の正しい流れ**

   - 作業開始: `gh issue edit [番号] --add-label "in progress"`でステータス変更
   - 実装作業: featureブランチで開発
   - 実装完了: Issueにコメントで実装内容とコミット番号を記載
   - PR作成: Issue番号を含むPRを作成
   - レビュー待ち: `gh issue edit [番号] --remove-label "in progress" --add-label "in review"`でステータス変更
   - マージ完了: PRマージ時に自動的にIssueクローズ（`Fixes #番号`使用）

3. **GitHub Projects連携**
   - 可能な場合はGitHub Projectsでカンバン管理
   - To Do → In Progress → In Review → Doneの流れ
   - **注意**: 現在のリポジトリには `in progress` や `in review` ラベルが存在しない
   - ラベルがない場合は、コメントで状態を明示（例：「作業開始しました」「PR #XX を作成しました。レビューをお願いします」）
