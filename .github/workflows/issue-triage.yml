name: Issue Triage

on:
  issues:
    types: [opened, edited]

permissions:
  issues: write

jobs:
  triage:
    runs-on: ubuntu-latest

    steps:
      - name: Auto-label based on title and body
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = (issue.body || '').toLowerCase();
            const content = title + ' ' + body;

            const labelsToAdd = [];

            // Category detection
            if (content.includes('ai') || content.includes('é›£æ˜“åº¦') || content.includes('ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿')) {
              labelsToAdd.push('ai');
            }
            if (content.includes('ui') || content.includes('ãƒ‡ã‚¶ã‚¤ãƒ³') || content.includes('è¡¨ç¤º') || content.includes('ç”»é¢')) {
              labelsToAdd.push('ui-ux');
            }
            if (content.includes('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹') || content.includes('é…ã„') || content.includes('é‡ã„')) {
              labelsToAdd.push('performance');
            }
            if (content.includes('ã‚²ãƒ¼ãƒ ') || content.includes('ãƒ«ãƒ¼ãƒ«') || content.includes('çŸ³') || content.includes('ç›¤é¢')) {
              labelsToAdd.push('game-logic');
            }
            if (content.includes('ãƒ†ã‚¹ãƒˆ') || content.includes('test')) {
              labelsToAdd.push('testing');
            }

            // Priority detection
            if (content.includes('ç·Šæ€¥') || content.includes('ã‚¯ãƒ©ãƒƒã‚·ãƒ¥') || content.includes('å‹•ã‹ãªã„')) {
              labelsToAdd.push('priority-high');
            }

            if (labelsToAdd.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labelsToAdd
              });
            }

      - name: Welcome first-time contributors
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;

            // Check if this is their first issue
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              creator: issue.user.login,
              state: 'all'
            });

            if (issues.length === 1) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ğŸ‘‹ @${issue.user.login} ã•ã‚“ã€Issueä½œæˆã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

            ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®åˆã‚ã¦ã®Issueã§ã™ã­ã€‚

            ## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
            1. ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ãŒIssueã‚’ç¢ºèªã—ã¾ã™
            2. å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã®æƒ…å ±ã‚’ãŠä¼ºã„ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™
            3. å¯¾å¿œãŒæ±ºã¾ã‚Šæ¬¡ç¬¬ã€æ‹…å½“è€…ãŒã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã¾ã™

            ã”ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ãŠæ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„ï¼`
              });
            }
